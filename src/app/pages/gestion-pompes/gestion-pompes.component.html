<div class="container">
  <aside class="sidebar">
    <app-sidebar></app-sidebar>
  </aside>
  
  <main class="main-content">
    <div class="card">
      <!-- Header -->
      <div class="header">
        <h1>Gestion des Pompes</h1>
        <div class="header-buttons">
          <button class="btn-delete" [disabled]="!hasSelection" (click)="deleteSelected()">
            <i class="fas fa-trash-alt"></i> Supprimer
          </button>
          <button class="btn-add" (click)="openModal('addModal')">
            <i class="fas fa-plus"></i> Ajouter
          </button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="search-section">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            placeholder="Rechercher par Type de Pompe..." 
            class="search-input"
          />
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th><input type="checkbox" [checked]="allSelected" (change)="toggleAllSelection()"/></th>
              <th>Numero de serie</th>
              <th>Type de Pompe</th>
              <th>Prix Unitaire (L)</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let pompe of filteredPompes">
              <td><input type="checkbox" [(ngModel)]="pompe.selected" (change)="checkSelection()"/></td>
              <td>{{ pompe.numeroSerie }}</td>
              <td>{{ pompe.typeCarburant }}</td>
              <td>{{ pompe.prix }} FCFA</td>
              <td>
                <span [class]="'status ' + (pompe.status === 'Active' ? 'status-active' : 'status-inactive')">
                  {{ pompe.status }}
                </span>
              </td>
              <td>
                <div class="actions">
                  <button class="btn-action edit" [disabled]="pompe.status !== 'Active'" (click)="openModal('editModal', pompe)">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn-action view" [disabled]="pompe.status !== 'Active'" (click)="openModal('viewModal', pompe)">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn-action delete" [disabled]="pompe.status !== 'Active'" (click)="openConfirmDeleteModal(pompe)">
                    <i class="fas fa-trash"></i>
                  </button>
                  <button class="btn-action block" (click)="toggleBlockPump(pompe)">
                    <i class="fas" [ngClass]="pompe.status === 'Active' ? 'fa-unlock' : 'fa-lock'"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>

<div id="addModal" class="modal">
  <div class="modal-content">
    <span class="close" (click)="closeModal('addModal')">&times;</span>
    <h2><i class="fas fa-gas-pump"></i> Ajouter une Pompe</h2>

    <label>Type de Pompe :</label>
    <select [(ngModel)]="newPump.typeCarburant" required>
      <option value="" disabled selected>Sélectionnez un type</option>
      <option value="diesel">Diesel</option>
      <option value="gazoil">Gazoil</option>
      <option value="gpl">GPL</option>
    </select>
    <p class="error" *ngIf="isSubmitted && !newPump.typeCarburant">⚠ Le type de pompe est requis</p>

    <label>Prix Unitaire (L) :</label>
    <input type="number" [(ngModel)]="newPump.prix" required min="1">
    <p class="error" *ngIf="isSubmitted && (!newPump.prix || newPump.prix < 1)">⚠ Le prix unitaire est requis et doit être supérieur à 0</p>

    <button (click)="addPump()">Ajouter</button>
  </div>
</div>


<div id="editModal" class="modal">
  <div class="modal-content">
      <span class="close" (click)="closeModal('editModal')">&times;</span>
      <h2><i class="fas fa-gas-pump"></i> Modifier la Pompe</h2>

      <label>Type de Pompe :</label>
      <input *ngIf="selectedPump" type="text" [(ngModel)]="selectedPump.typeCarburant" required>
      <p class="error" *ngIf="selectedPump && !selectedPump.typeCarburant">⚠ Le type de pompe est requis</p>

      <label>Prix Unitaire (L) :</label>
      <input *ngIf="selectedPump" type="number" [(ngModel)]="selectedPump.prix" required min="1">
      <p class="error" *ngIf="selectedPump && (!selectedPump.prix || selectedPump.prix < 1)">⚠ Le prix unitaire est requis et doit être supérieur à 0</p>

      <button *ngIf="selectedPump" (click)="editPump(selectedPump)" [disabled]="!selectedPump.typeCarburant || !selectedPump.prix || selectedPump.prix < 1">Modifier</button>
  </div>
</div>

<!-- Message de succès -->
<div id="successModal" class="modal">
  <div class="modal-content">
      <span class="close" (click)="closeModal('successModal')">&times;</span>
      <h2><i class="fas fa-check-circle"></i> Succès</h2>
      <p>La pompe a été ajoutée avec succès !</p>
  </div>
</div>

<!-- Message de confirmation de suppression -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <span class="close" (click)="closeModal('deleteModal')">&times;</span>
    <h2><i class="fas fa-gas-pump"></i> Confirmer la Suppression</h2>
    <p>Êtes-vous sûr de vouloir supprimer la pompe <strong>{{ selectedPump?.numeroSerie }}</strong> ?</p>
    <button (click)="confirmDeletePump()">Oui</button>
    <button (click)="closeModal('deleteModal')">Non</button>
  </div>
</div>
